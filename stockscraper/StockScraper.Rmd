---
title: "stocks"
output: html_document
---

## StockScraper

So a slow weekend means working on some of my non-bioinformatics projects. This time it was writing an R script to scrape historical stock data from Yahoo finance using R. This comes after Yahoo broke everyone's scripts (including one I had written in bash) by changing their API to require a cookie/crumb pair. I won't go into detail about solving that problem (reg ex) or much about the script itself but feel free to have a look at it  [here.](https://github.com/ScientistJake/StockScraper.R). The important thing is that it works.

I should note that another R package that I like very much, [quantmod](https://cran.r-project.org/web/packages/quantmod/index.html), includes the similar function getsymbols(). There's a few things I dislike about getsymbols(), namely that when downloading multiple stocks it loads each one as a separate variable in the environment. This sucks if you're downloading an entire exchange like NYSE. The other downside is not being able to limit the date range which again is useful when dealing with alrge numbers of stocks.

With that let's take the StockScraper for a spin. First we need to source it since I'm too lazy to package it:

```{r install}
source("https://raw.githubusercontent.com/ScientistJake/StockScraper.R/master/StockScraper.R")
```

As you can see the script includes two functions. The primary function, stockhistoricals() is to download the data. The helper function get_stocklists() is a way to retrieve the stocklists for NYSE, AMEX and NASDAQ. It retrieves a lot of good stock metadata too which could be useful later when building correlation analysis. 

Let's bulk download NASDAQ as an example. Here I'm being explicit in the arguments but you can run them with their defaults listed at the top of the function. I usually run it with verbose=TRUE to monitor it but that would look like crap in this markdown!

```{r downlaod}
NASDAQ <- stockhistoricals(stocklist="NASDAQ", start_date = "2016-09-11", end_date = "2017-09-11", verbose = FALSE)
```

So now we have a years worth of stock price historicals for the entire NASDAQ exchange. The data is stored as a list of dataframes named for the stock tickers. Check it out:

```{r check it out}
#list the first ten stocks
names(NASDAQ)[1:10]
```

We can retrieve individual stock data using standard R list notation:

```{r GOOG}
#check out GOOG
head(NASDAQ$GOOG)
```

If you're comfortable with lists we can work directly with the list for simple analyses:

```{r GOOGavg}
#Get the average adjusted close price for GOOG
mean(NASDAQ$GOOG$Adj.Close)
```

Or we can extract stocks and do fun things like plot them.

```{r GOOGplot}
#extract GOOG
GOOG <- data.frame(NASDAQ$GOOG)
names(GOOG) <- c("Date","Open","High","Low","Close","Adj.Close","Volume")

#plot it out!
library(ggplot2)
ggplot(GOOG, aes(x = Date, y = Close)) +
geom_line() +
labs(title = "GOOG Line Chart", y = "Closing Price", x = "")
```

Good luck and happy data-mining!

### Session
```{r session}
sessionInfo()
```

